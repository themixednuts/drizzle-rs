{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://raw.githubusercontent.com/themixednuts/drizzle-rs/master/cli/schema.json",
  "title": "Drizzle Configuration",
  "description": "Configuration schema for drizzle-rs CLI tool",
  "type": "object",
  "definitions": {
    "envOr": {
      "description": "A value that can be a direct string or an environment variable reference",
      "oneOf": [
        { "type": "string" },
        {
          "type": "object",
          "required": ["env"],
          "properties": {
            "env": {
              "type": "string",
              "description": "Environment variable name"
            }
          },
          "additionalProperties": false
        }
      ]
    },
    "dialect": {
      "description": "Database dialect",
      "type": "string",
      "enum": ["sqlite", "postgresql", "postgres", "turso"]
    },
    "sqliteDriver": {
      "description": "Driver for SQLite dialect",
      "type": "string",
      "enum": ["rusqlite"]
    },
    "tursoDriver": {
      "description": "Driver for Turso dialect",
      "type": "string",
      "enum": ["libsql", "turso"]
    },
    "postgresDriver": {
      "description": "Driver for PostgreSQL dialect",
      "type": "string",
      "enum": ["postgres-sync", "tokio-postgres"]
    },
    "schemaPath": {
      "description": "Path or array of paths to schema files (glob patterns supported)",
      "oneOf": [
        { "type": "string" },
        {
          "type": "array",
          "items": { "type": "string" },
          "minItems": 1
        }
      ],
      "default": "src/schema.rs"
    },
    "filter": {
      "oneOf": [
        { "type": "string" },
        {
          "type": "array",
          "items": { "type": "string" }
        }
      ]
    },
    "casing": {
      "description": "Casing mode for generated code",
      "type": "string",
      "enum": ["camel_case", "snake_case"]
    },
    "introspect": {
      "description": "Introspection configuration",
      "type": "object",
      "properties": {
        "casing": {
          "type": "string",
          "enum": ["camel", "preserve"],
          "default": "camel"
        }
      },
      "additionalProperties": false
    },
    "migrations": {
      "description": "Migration table configuration",
      "type": "object",
      "properties": {
        "table": {
          "description": "Custom table name for migrations (default: __drizzle_migrations)",
          "type": "string"
        },
        "schema": {
          "description": "Schema for migrations table (PostgreSQL only)",
          "type": "string"
        },
        "prefix": {
          "description": "Migration file naming prefix",
          "type": "string",
          "enum": ["index", "timestamp", "supabase", "unix", "none"]
        }
      },
      "additionalProperties": false
    },
    "dbCredentials": {
      "description": "Database credentials",
      "oneOf": [
        {
          "type": "object",
          "description": "URL-based credentials (SQLite file path, Turso/LibSQL URL, PostgreSQL connection string)",
          "required": ["url"],
          "properties": {
            "url": { "$ref": "#/definitions/envOr" },
            "authToken": {
              "$ref": "#/definitions/envOr",
              "description": "Auth token for Turso/LibSQL connections"
            }
          },
          "additionalProperties": false
        },
        {
          "type": "object",
          "description": "Host-based credentials for PostgreSQL",
          "required": ["host", "database"],
          "properties": {
            "host": { "$ref": "#/definitions/envOr" },
            "port": { "type": "integer", "minimum": 1, "maximum": 65535 },
            "user": { "$ref": "#/definitions/envOr" },
            "password": { "$ref": "#/definitions/envOr" },
            "database": { "$ref": "#/definitions/envOr" },
            "ssl": {
              "oneOf": [
                { "type": "boolean" },
                { "type": "string", "enum": ["require", "allow", "prefer", "verify-full", "disable"] }
              ]
            }
          },
          "additionalProperties": false
        }
      ]
    },
    "baseConfig": {
      "description": "Base configuration properties shared across all dialects",
      "type": "object",
      "properties": {
        "schema": { "$ref": "#/definitions/schemaPath" },
        "out": {
          "description": "Output directory for migrations",
          "type": "string",
          "default": "./drizzle"
        },
        "breakpoints": {
          "description": "Whether to use SQL breakpoints in generated migrations",
          "type": "boolean",
          "default": true
        },
        "tablesFilter": {
          "description": "Table filter for push/introspect commands",
          "$ref": "#/definitions/filter"
        },
        "verbose": {
          "description": "Verbose output",
          "type": "boolean",
          "default": false
        },
        "strict": {
          "description": "Strict mode (require confirmation)",
          "type": "boolean",
          "default": false
        },
        "casing": { "$ref": "#/definitions/casing" },
        "migrations": { "$ref": "#/definitions/migrations" },
        "introspect": { "$ref": "#/definitions/introspect" },
        "dbCredentials": { "$ref": "#/definitions/dbCredentials" }
      },
      "additionalProperties": true
    }
  },
  "oneOf": [
    {
      "description": "SQLite configuration",
      "type": "object",
      "required": ["dialect"],
      "allOf": [{ "$ref": "#/definitions/baseConfig" }],
      "properties": {
        "dialect": { "const": "sqlite" },
        "driver": { "$ref": "#/definitions/sqliteDriver" },
        "schema": { "$ref": "#/definitions/schemaPath" },
        "out": { "type": "string" },
        "breakpoints": { "type": "boolean" },
        "tablesFilter": { "$ref": "#/definitions/filter" },
        "verbose": { "type": "boolean" },
        "strict": { "type": "boolean" },
        "casing": { "$ref": "#/definitions/casing" },
        "migrations": { "$ref": "#/definitions/migrations" },
        "introspect": { "$ref": "#/definitions/introspect" },
        "dbCredentials": { "$ref": "#/definitions/dbCredentials" }
      },
      "additionalProperties": false
    },
    {
      "description": "Turso configuration",
      "type": "object",
      "required": ["dialect"],
      "allOf": [{ "$ref": "#/definitions/baseConfig" }],
      "properties": {
        "dialect": { "const": "turso" },
        "driver": { "$ref": "#/definitions/tursoDriver" },
        "schema": { "$ref": "#/definitions/schemaPath" },
        "out": { "type": "string" },
        "breakpoints": { "type": "boolean" },
        "tablesFilter": { "$ref": "#/definitions/filter" },
        "verbose": { "type": "boolean" },
        "strict": { "type": "boolean" },
        "casing": { "$ref": "#/definitions/casing" },
        "migrations": { "$ref": "#/definitions/migrations" },
        "introspect": { "$ref": "#/definitions/introspect" },
        "dbCredentials": { "$ref": "#/definitions/dbCredentials" }
      },
      "additionalProperties": false
    },
    {
      "description": "PostgreSQL configuration",
      "type": "object",
      "required": ["dialect"],
      "allOf": [{ "$ref": "#/definitions/baseConfig" }],
      "properties": {
        "dialect": { "enum": ["postgresql", "postgres"] },
        "driver": { "$ref": "#/definitions/postgresDriver" },
        "schema": { "$ref": "#/definitions/schemaPath" },
        "out": { "type": "string" },
        "breakpoints": { "type": "boolean" },
        "tablesFilter": { "$ref": "#/definitions/filter" },
        "schemaFilter": {
          "description": "Schema filter for PostgreSQL",
          "$ref": "#/definitions/filter"
        },
        "verbose": { "type": "boolean" },
        "strict": { "type": "boolean" },
        "casing": { "$ref": "#/definitions/casing" },
        "migrations": { "$ref": "#/definitions/migrations" },
        "introspect": { "$ref": "#/definitions/introspect" },
        "dbCredentials": { "$ref": "#/definitions/dbCredentials" }
      },
      "additionalProperties": false
    },
    {
      "description": "Multi-database configuration",
      "type": "object",
      "required": ["databases"],
      "allOf": [{ "$ref": "#/definitions/baseConfig" }],
      "properties": {
        "schema": { "$ref": "#/definitions/schemaPath" },
        "out": { "type": "string" },
        "breakpoints": { "type": "boolean" },
        "verbose": { "type": "boolean" },
        "strict": { "type": "boolean" },
        "casing": { "$ref": "#/definitions/casing" },
        "databases": {
          "description": "Named database configurations",
          "type": "object",
          "additionalProperties": {
            "oneOf": [
              {
                "type": "object",
                "required": ["dialect"],
                "properties": {
                  "dialect": { "const": "sqlite" },
                  "driver": { "$ref": "#/definitions/sqliteDriver" },
                  "schema": { "$ref": "#/definitions/schemaPath" },
                  "out": { "type": "string" },
                  "breakpoints": { "type": "boolean" },
                  "tablesFilter": { "$ref": "#/definitions/filter" },
                  "verbose": { "type": "boolean" },
                  "strict": { "type": "boolean" },
                  "casing": { "$ref": "#/definitions/casing" },
                  "migrations": { "$ref": "#/definitions/migrations" },
                  "introspect": { "$ref": "#/definitions/introspect" },
                  "dbCredentials": { "$ref": "#/definitions/dbCredentials" }
                },
                "additionalProperties": false
              },
              {
                "type": "object",
                "required": ["dialect"],
                "properties": {
                  "dialect": { "const": "turso" },
                  "driver": { "$ref": "#/definitions/tursoDriver" },
                  "schema": { "$ref": "#/definitions/schemaPath" },
                  "out": { "type": "string" },
                  "breakpoints": { "type": "boolean" },
                  "tablesFilter": { "$ref": "#/definitions/filter" },
                  "verbose": { "type": "boolean" },
                  "strict": { "type": "boolean" },
                  "casing": { "$ref": "#/definitions/casing" },
                  "migrations": { "$ref": "#/definitions/migrations" },
                  "introspect": { "$ref": "#/definitions/introspect" },
                  "dbCredentials": { "$ref": "#/definitions/dbCredentials" }
                },
                "additionalProperties": false
              },
              {
                "type": "object",
                "required": ["dialect"],
                "properties": {
                  "dialect": { "enum": ["postgresql", "postgres"] },
                  "driver": { "$ref": "#/definitions/postgresDriver" },
                  "schema": { "$ref": "#/definitions/schemaPath" },
                  "out": { "type": "string" },
                  "breakpoints": { "type": "boolean" },
                  "tablesFilter": { "$ref": "#/definitions/filter" },
                  "schemaFilter": { "$ref": "#/definitions/filter" },
                  "verbose": { "type": "boolean" },
                  "strict": { "type": "boolean" },
                  "casing": { "$ref": "#/definitions/casing" },
                  "migrations": { "$ref": "#/definitions/migrations" },
                  "introspect": { "$ref": "#/definitions/introspect" },
                  "dbCredentials": { "$ref": "#/definitions/dbCredentials" }
                },
                "additionalProperties": false
              }
            ]
          },
          "minProperties": 1
        }
      },
      "additionalProperties": false
    }
  ]
}
