[package]
name = "drizzle-rs"
version.workspace = true
edition.workspace = true
authors.workspace = true
keywords.workspace = true
description.workspace = true
license.workspace = true
repository.workspace = true

[workspace]
resolver = "3"
members = ["procmacros", "core", "sqlite", "postgres", "mysql"]

[workspace.package]
version = "0.1.0"
edition = "2024"
authors = ["Mixed Nuts"]
keywords = ["drizzle", "rizzle", "orm", "database", "sqlite"]
description = "A type-safe SQL query builder for Rust"
license = "MIT"
repository = "https://github.com/themixednuts/drizzle-rs"

[workspace.dependencies]
drizzle-rs = { path = "." }
drizzle_core = { path = "./core" }
sqlite = { path = "./sqlite" }
postgres = { path = "./postgres" }
mysql = { path = "./mysql" }
procmacros = { path = "./procmacros" }
paste = { version = "1.0.15" }
uuid = { version = "1.16.0", features = ["v4", "serde"] }
serde = { version = "1.0", features = ["derive"] }
serde_json = { version = "1.0" }
anyhow = "1.0.75"
thiserror = "1.0.49"
rusqlite = { version = "0.34.0", features = ["bundled", "uuid"] }
libsql = { version = "0.9" }
libsql-rusqlite = { version = "0.33.0", features = ["bundled"] }
frunk = { version = "0.4.4" }
smallvec = { version = "1.15.1", features = ["union", "const_new", "const_generics"] }

# Add dev-dependencies for tests
[dev-dependencies]
drizzle-rs = { path = ".", features = ["rusqlite", "uuid", "serde"] }
anyhow = "1.0.75"

[features]
rusqlite = [
  "dep:rusqlite",
  "sqlite/rusqlite",
  "sqlite",
  "procmacros/rusqlite",
  "drizzle_core/rusqlite",
]
libsql = ["dep:libsql", "sqlite/libsql", "sqlite", "procmacros/libsql"]
libsql-rusqlite = [
  "dep:libsql-rusqlite",
  "sqlite/libsql-rusqlite",
  "sqlite",
  "procmacros/libsql-rusqlite",
]
serde = [
  "dep:serde_json",
  "dep:serde",
  "sqlite/serde",
  "postgres/serde",
  "mysql/serde",
  "procmacros/serde",
  "drizzle_core/serde",
  "rusqlite/serde_json",
]
uuid = [
  "dep:uuid",
  "sqlite/uuid",
  "postgres/uuid",
  "mysql/uuid",
  "drizzle_core/uuid",
  "rusqlite/uuid",
]

# Add dialect-specific features back for gating re-exports
sqlite = ["procmacros/sqlite", "dep:sqlite"]
postgres = ["procmacros/postgres", "dep:postgres"]
mysql = ["procmacros/mysql", "dep:mysql"]

[dependencies]
procmacros = { workspace = true }
paste = { workspace = true }
drizzle_core = { workspace = true }

# Optional dependencies activated by features
sqlite = { workspace = true, optional = true }
postgres = { workspace = true, optional = true }
mysql = { workspace = true, optional = true }
rusqlite = { workspace = true, optional = true }
libsql = { workspace = true, optional = true }
libsql-rusqlite = { workspace = true, optional = true }
uuid = { workspace = true, optional = true }
serde = { workspace = true, optional = true }
serde_json = { workspace = true, optional = true }
